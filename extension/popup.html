<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>AI Social Search</title>
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <main class="shell">
      <section class="card">
        <header class="card__header">
          <div>
            <h1>AI Search</h1>
            <p class="subtitle">Tag-based collection or AI reranking</p>
          </div>
          <div class="mode-switch">
            <button type="button" id="modeCollector" class="mode-btn active">Tag Collector</button>
            <button type="button" id="modeReranker" class="mode-btn">Smart Reranker</button>
          </div>
        </header>

        <!-- TAG COLLECTOR MODE -->
        <div id="collectorPanel" class="mode-panel">
          <section class="group">
            <h2>Select Tags</h2>
            <div class="tags-container">
              <button type="button" class="tag-chip" data-tag="Food">ğŸ³ Food</button>
              <button type="button" class="tag-chip" data-tag="Creativity">ğŸ¨ Creativity</button>
              <button type="button" class="tag-chip" data-tag="DIY">ğŸ”¨ DIY</button>
              <button type="button" class="tag-chip" data-tag="Art">ğŸ–¼ï¸ Art</button>
              <button type="button" class="tag-chip" data-tag="Tutorial">ğŸ“š Tutorial</button>
              <button type="button" class="tag-chip" data-tag="Crafts">âœ‚ï¸ Crafts</button>
              <button type="button" class="tag-chip" data-tag="Education">ğŸ“ Education</button>
              <button type="button" class="tag-chip" data-tag="Music">ğŸµ Music</button>
              <button type="button" class="tag-chip" data-tag="Gaming">ğŸ® Gaming</button>
              <button type="button" class="tag-chip" data-tag="Technology">ğŸ’» Technology</button>
              <button type="button" class="tag-chip" data-tag="Nature">ğŸŒ¿ Nature</button>
              <button type="button" class="tag-chip" data-tag="Gardening">ğŸŒ± Gardening</button>
            </div>
            <div class="field">
              <label for="customTags">Custom Tags (comma-separated)</label>
              <input type="text" id="customTags" placeholder="e.g., watercolor, origami, baking" />
              <p class="hint">Add specific tags matching what you're looking for</p>
            </div>
          </section>

          <section class="group">
            <h2>Collection Settings</h2>
            <div class="field-grid">
              <label class="field">
                <span>Min Match Score</span>
                <input type="number" id="collectorMinScore" min="0" max="100" value="15" step="5" />
                <p class="hint">Minimum score threshold (%)</p>
              </label>
              <label class="field">
                <span>Max Videos</span>
                <input type="number" id="collectorMaxVideos" min="10" max="200" value="50" step="10" />
                <p class="hint">Stop after this many matches</p>
              </label>
            </div>
          </section>

          <section class="group">
            <div class="collector-controls">
              <button type="button" id="startCollection" class="primary large">
                <span class="btn-icon">ğŸ¯</span>
                Start Collecting
              </button>
              <button type="button" id="stopCollection" class="ghost large" style="display: none;">
                <span class="btn-icon">â¹ï¸</span>
                Stop Collection
              </button>
            </div>
            <div id="collectionProgress" style="display: none;">
              <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
              </div>
              <p class="progress-text">
                <span id="progressStatus">Scrolling and analyzing...</span>
                <span id="progressCount">0 / 50 videos found</span>
              </p>
            </div>
          </section>

          <section class="group" id="resultsSection" style="display: none;">
            <h2>Collected Videos</h2>
            <div id="videoResults" class="video-list"></div>
            <div class="actions">
              <button type="button" id="copyLinks" class="primary">ğŸ“‹ Copy All Links</button>
              <button type="button" id="createPlaylist" class="primary">ğŸ“º Create Playlist</button>
              <button type="button" id="clearResults" class="ghost">ğŸ—‘ï¸ Clear Results</button>
            </div>
          </section>
        </div>

        <!-- SMART RERANKER MODE -->
        <div id="rerankerPanel" class="mode-panel" style="display: none;">
          <label class="toggle">
            <input type="checkbox" id="enabled" />
            <span class="toggle__label">Enable semantic reranking</span>
          </label>

          <section class="group">
            <h2>Connection</h2>
            <div class="field with-action">
              <label for="backendUrl">Backend URL</label>
              <div class="field__row">
                <input type="url" id="backendUrl" placeholder="http://127.0.0.1:5000/search" />
                <button type="button" class="ghost" id="test">Test</button>
              </div>
            <p class="hint">Flask endpoint (test pings <code>/health</code>)</p>
          </div>
        </section>

        <section class="group">
          <h2>Scoring</h2>
          <div class="field-grid">
            <label class="field">
              <span>Max results to score</span>
              <input type="number" id="maxItems" min="5" max="50" step="1" />
              <p class="hint">More = slower but more coverage</p>
            </label>
            <label class="field">
              <span>Minimum match %</span>
              <input type="number" id="minScore" min="0" max="100" step="1" />
              <p class="hint">Below this won't be highlighted</p>
            </label>
            <label class="field">
              <span>Image emphasis</span>
              <select id="imageMode">
                <option value="balanced">Balanced</option>
                <option value="boosted">Boost visuals</option>
                <option value="strict">Only strong visuals</option>
              </select>
              <p class="hint">Prioritize thumbnail matching</p>
            </label>
          </div>
        </section>

        <!-- Advanced Settings (Collapsible) -->
        <div class="advanced-section">
          <button type="button" class="advanced-toggle" id="advancedToggle">
            <span class="advanced-arrow">â–¶</span>
            <span>Advanced</span>
          </button>
          <div class="advanced-content" id="advancedContent" style="display: none;">
            <section class="group">
              <h2>Display</h2>
              <label class="toggle">
                <input type="checkbox" id="enableReorder" />
                <span class="toggle__label">Reorder results by AI score</span>
              </label>
              <label class="toggle">
                <input type="checkbox" id="showBadges" />
                <span class="toggle__label">Show AI match badges</span>
              </label>
            </section>

            <section class="group">
              <h2>Filters</h2>
              <label class="toggle">
                <input type="checkbox" id="enableMusicFilter" checked />
                <span class="toggle__label">Filter music/entertainment</span>
              </label>
              <label class="toggle">
                <input type="checkbox" id="enableBrandFilter" checked />
                <span class="toggle__label">Filter Apple brand (for "apple")</span>
              </label>
              <label class="toggle">
                <input type="checkbox" id="enableIntentBoost" checked />
                <span class="toggle__label">Boost query intent matching</span>
              </label>
              <label class="toggle">
                <input type="checkbox" id="enableTemporalBoost" checked />
                <span class="toggle__label">Boost recent/trending</span>
              </label>
            </section>

            <section class="group">
              <h2>Feedback Stats</h2>
              <div id="feedbackStats" class="stats-container">
                <p class="hint">Loading feedback data...</p>
              </div>
              <button type="button" class="ghost" id="refreshStats">Refresh Stats</button>
              <button type="button" class="ghost" id="clearFeedback">Clear Feedback</button>
            </section>
          </div>
        </div>

          <footer class="actions">
            <button type="button" class="ghost" id="reset">Reset</button>
            <button type="button" id="save">Save</button>
          </footer>
        </div>
        <!-- End Reranker Panel -->

        <p id="status" role="status"></p>
      </section>
    </main>
    <script src="popup.js" type="module"></script>
  </body>
</html>
